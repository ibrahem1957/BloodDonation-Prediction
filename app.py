# -*- coding: utf-8 -*-
"""Project2 DT and ML.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1Ch7otgmqEQa-4xYXIYddtoQbH26iubIT

# **Import Libraries**
"""

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns


from sklearn.model_selection import train_test_split
from sklearn.preprocessing import LabelEncoder
from sklearn.metrics import accuracy_score, classification_report
from sklearn.ensemble import RandomForestClassifier
from sklearn.tree import DecisionTreeClassifier
from sklearn.linear_model import LogisticRegression
from sklearn.neighbors import KNeighborsClassifier
from sklearn.svm import SVC

"""# **Load,Read Dataset**"""

df=pd.read_csv('/content/blood_donation.csv')

df.head()

df.tail()

df.shape

"""# EDA (Exploratory Data Analysis)"""

df.info()

df.describe()

df.isnull().sum()

df.duplicated().sum()

print(df['Donation_Year'].unique())
print(df['Donation_Month'].unique())

df['Country'].nunique()

df['Donation_Center'].unique()

df.drop(columns=['Full_Name','Contact_Number','Email','Country','Donor_ID'], inplace=True)

df['Last_Donation_Date'] = pd.to_datetime(df['Last_Donation_Date'],format='%d-%m-%Y', errors='coerce')
df['Donation_Year'] = df['Last_Donation_Date'].dt.year

df['Donation_Month'] = df['Last_Donation_Date'].dt.month

"""# **Data Analysis**"""

df.head()

df.groupby("Gender")['Blood_Group'].value_counts()

"""| Blood Type | Can Donate To    | Can Receive From |
| ---------- | ---------------- | ---------------- |
| **O-**     | All types        | O-               |
| **O+**     | O+, A+, B+, AB+  | O-, O+           |
| **A-**     | A-, A+, AB-, AB+ | A-, O-           |
| **A+**     | A+, AB+          | A+, A-, O+, O-   |
| **B-**     | B-, B+, AB-, AB+ | B-, O-           |
| **B+**     | B+, AB+          | B+, B-, O+, O-   |
| **AB-**    | AB-, AB+         | AB-, A-, B-, O-  |
| **AB+**    | AB+              | All types        |


Reasons for Blood Type Distribution in India

Genetic reason:
O+ and B+ are more common among the population, A+ is less common, and AB+ is rare.

Compatibility reason:
O+ can donate to most positive blood types → appears more in donations.
AB+ can donate only to AB → appears less in donations.
"""

plt.figure(figsize=(8,5))

sns.countplot(data=df, x='Blood_Group', palette=['#440154', '#31688E', '#35B779', '#FDE725', '#F46D43', '#5C4D7D', '#C51B7D', '#FDE0A4'])

plt.title('Number of Donors by Blood Group')
plt.xlabel('Blood Group')
plt.ylabel('Number of Donors')
plt.grid(axis='y', linestyle='--', alpha=0.5)

plt.show()

donor_counts = df.groupby('Gender')['Blood_Group'].count()

plt.figure(figsize=(6,6))
plt.pie(donor_counts, labels=donor_counts.index, autopct='%1.1f%%', colors=['skyblue','lightcoral'])
plt.title('Donor Distribution by Gender')
plt.show()

donation_per_year = df.groupby('Donation_Year')['Blood_Group'].count()

plt.figure(figsize=(8,5))
donation_per_year.plot(kind='line', marker='o', color='skyblue')
plt.title('Number of Donations per Year')
plt.xlabel('Year')
plt.ylabel('Number of Donations')
plt.xticks(donation_per_year.index)
plt.grid(True)
plt.show()

gender_year = df.groupby("Donation_Year")['Gender'].value_counts().unstack(fill_value=0)

gender_year.plot(kind='bar', figsize=(8,5))
plt.title("Donations per Year by Gender (Stacked)")
plt.xlabel("Year")
plt.ylabel("Total Donations")
plt.xticks(rotation=0)
plt.grid(axis='y')
plt.show()

"""| Gender | Normal Hemoglobin (g/dL) |
| ------ | ------------------------ |
| Men    | 13.8 – 17.2              |
| Women  | 12.1 – 15.1              |

"""

mean_hb = df.groupby('Gender')['Hemoglobin_g_dL'].mean()

ax = mean_hb.plot(kind='bar', color=['#2E8B57', '#FFA07A'], edgecolor='black')

for p in ax.patches:
    height = p.get_height()
    ax.text(p.get_x() + p.get_width()/2, height + 0.1, f'{height:.2f}',
            ha='center', va='bottom', fontsize=12, color='black')

plt.title('Average Hemoglobin by Gender')
plt.ylabel('Hemoglobin (g/dL)')
plt.xlabel('Gender')
plt.grid(axis='y', linestyle='--', alpha=0.5)

plt.show()

top_cities = df.groupby("City")['Blood_Group'].count().sort_values(ascending=False).head()

ax = top_cities.plot(kind='bar', color=['#4C72B0', '#55A868', '#C44E52', '#8172B3', '#CCB974'], edgecolor='black')

plt.title('Top 5 Cities by Number of Donors')
plt.xlabel('City')
plt.ylabel('Number of Donors')
plt.grid(axis='y', linestyle='--', alpha=0.5)

plt.show()

plt.figure(figsize=(8,5))
plt.hist(df['Age'], bins=10, color='skyblue', edgecolor='black')
plt.title('Distribution of Donors Age')
plt.xlabel('Age')
plt.ylabel('Number of Donors')
plt.show()

plt.figure(figsize=(10,6))
sns.boxplot(data=df, x='Blood_Group', y='Age', palette='Set2')
plt.title('Age Distribution by Blood Group')
plt.show()

sns.scatterplot(data=df, x='Weight_kg', y='Hemoglobin_g_dL', hue='Gender', palette='Set1')

sns.heatmap(df.corr(numeric_only=True),annot=True)

df.head()

"""# **Feature Engineering**"""

label_cols = ['Gender', 'Blood_Group', 'City', 'State',  'Eligible_for_Donation']
le = LabelEncoder()

for col in label_cols:
    df[col] = le.fit_transform(df[col].astype(str))

"""# **Data Splitting**"""

X = df[['Age', 'Gender', 'Weight_kg', 'Hemoglobin_g_dL',
        'Total_Donations', 'Blood_Group']]
y = df['Eligible_for_Donation']

# Train/Test split
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

"""# **Model Training**"""

model_R = RandomForestClassifier()
model_D= DecisionTreeClassifier()
model_L= LogisticRegression()
model_K= KNeighborsClassifier()
model_S= SVC()
all_model=[model_R,model_D,model_L,model_K,model_S]

"""# **The best model is RandomForestClassifier**

# **Model Evaluation**
"""

def Test(model):
    model.fit(X_train, y_train)
    y_pred = model.predict(X_test)
    print(f'The Model is :{model},',"Accuracy:", accuracy_score(y_test, y_pred))

for i in all_model:
  Test(i)

"""# **Testing on New Data**"""

# --- 1) New Data ---
new_data = pd.DataFrame([
    [31, "Male", "O+", 72, 15.0, 3],
    [26, "Female", "A+", 55, 11.2, 1],
    [45, "Male", "B+", 80, 14.3, 4],
    [22, "Male", "O-", 68, 16.1, 2],
    [34, "Female", "AB+", 63, 12.3, 1]
], columns=["Age","Gender","Blood_Group","Weight_kg","Hemoglobin_g_dL","Total_Donations"])

label_cols = ['Gender', 'Blood_Group']
encoders = {}

for col in label_cols:
    le = LabelEncoder()
    le.fit(df[col].astype(str))
    encoders[col] = le
    new_data[col] = le.transform(new_data[col].astype(str))

# --- 3) Select features ---
X_new = new_data[['Age','Gender','Weight_kg','Hemoglobin_g_dL','Total_Donations','Blood_Group']]


predictions = model_R.predict(X_new)

result_df = new_data.copy()
result_df['Prediction'] = ["Eligible" if val==1 else "Not Eligible" for val in predictions]


result_df['Gender'] = encoders['Gender'].inverse_transform(result_df['Gender'])
result_df['Blood_Group'] = encoders['Blood_Group'].inverse_transform(result_df['Blood_Group'])


print("Predictions for New Data with Details:")
(result_df)

"""| Factor             | Observation / Insight                                                       |
| ------------------ | --------------------------------------------------------------------------- |
| Hemoglobin (Hb)    | Normal or high Hb → Eligible; Low Hb → Not Eligible. Most important factor. |
| Gender             | Males more likely to be eligible due to higher normal Hb.                   |
| Age                | Age 20-50 does not affect eligibility if Hb is normal.                      |
| Blood Group        | No clear impact on eligibility in this example.                             |
| Weight & Donations | Adequate weight and moderate number of donations increase eligibility.      |

"""

